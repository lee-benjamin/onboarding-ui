<!doctype HTML>
<html>
  <head>
    <link id="stylesheet" rel="stylesheet" href="styles/style.css" type="text/css">
    <meta charset="utf-8">
  </head>
  <body>
    <div id="title">Lab for Ben Lee</div>
    <button type="button" onclick="getHomeTimeline()">Get Home Timeline</button>
    <div id="divTimeline">
    </div>
    <script>
      function appendTweet(tweet, color) {
        // Each tweet will live in a <div>
        var tweetDiv = document.createElement("div");
        if (color) {
          tweetDiv.setAttribute("class", "lightTweet");
        }
        else {
          tweetDiv.setAttribute("class", "darkTweet");
        }

        // Append the image
        var tweetImg = document.createElement("img");
        tweetImg.setAttribute("class", "img-circle");
        tweetImg.src = tweet.user.profileImageURL;
        tweetDiv.appendChild(tweetImg);

        // Append the timestamp
        var tweetSpan = document.createElement("span");
        var createdAt = document.createTextNode(new Date(tweet.createdAt));
        tweetSpan.appendChild(createdAt);
        tweetDiv.appendChild(tweetSpan);

        // Append the body of the tweet
        var text = document.createTextNode(tweet.text);
        tweetDiv.appendChild(text);

        // Link the div to Twitter
        var a  = document.createElement("a");
        var urlPrefix = "https://twitter.com/TwitterAPI/status/";
        a.setAttribute("href", urlPrefix + tweet.id);
        a.setAttribute("target", "_blank");
        a.appendChild(tweetDiv);

        // Append the new tweet block to the DOM
        var element = document.getElementById("divTimeline");
        element.appendChild(a);
      }

      function getHomeTimeline() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
         document.getElementById("divTimeline").innerHTML = "";
          var stylesheet = document.styleSheets[0];
          stylesheet.insertRule("#divTimeline {border-style: solid; border-width: medium;}", 0);
          if (this.readyState == XMLHttpRequest.DONE)  {
            if (this.status == 200) {
              var obj = JSON.parse(this.responseText);
              for (var i=0;i<obj.length;i++) {
                  appendTweet(obj[i], i % 2 == 0);
              }
            }
            else {
              document.getElementById("divTimeline").innerHTML = "Unable to get home timeline, please try again later.";
            }
          }
        };
        xhttp.open("GET", "http://localhost:8080/api/1.0/twitter/timeline",true);
        xhttp.send();
      }
    </script>
  </body>
</html>
